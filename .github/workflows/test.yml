name: Test Neo-Transposer

on: [push]

env:
  NT_DB_HOST: host.docker.internal
  NT_DB_USER: root
  NT_DB_PASSWORD: root
  NT_DB_DATABASE: nt_only_songs
  NT_DB_TEST_DATABASE: nt_empty_tables
  NT_DEBUG: 1
  NT_PROFILER: 0
  NT_ADMIN_USERNAME: unused
  NT_ADMIN_PASSWORD: unused
  NT_ANALYTICS_ID: UA-xxxxxxxx-1
  NT_MAXMIND_LICENSE_KEY: ${{ secrets.NT_MAXMIND_LICENSE_KEY }}

jobs:
  test:
    runs-on: ubuntu-18.04
    strategy:
      matrix:
        operating-system: ['ubuntu-18.04', 'ubuntu-20.04']

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Build the dev Docker image
        run: make build-dev

      - name: Run fixture containers
        run: make serve

      - name: Unit & integration tests, functional test
        run: make test

      - name: Acceptance tests
        run: make test-acceptance

#      - uses: actions/upload-artifact@v2
#        with:
#          name: PHPUnit-coverage-report
#          path: tests/_output/coverage