{% set page_title = 'Voice measure wizard'|trans %}
{% extends "base.twig" %}

{% block page_class %}wizard-empiric{% endblock %}

{% block content %}

	<h1>{% block title %}{% endblock %}</h1>

	<div class="test-area">

		<p class="instructions">{% block instructions %}{% endblock %}</p>

		<div class="pre-song">
			<a href="javascript:void(0)" class="sound" id="sound">
				<span id="play-control" class="play-control stopped"><i>&nbsp;</i></span>
				As√≠ debes cantarlo:
				<audio src="{{ global.request.basepath }}/static/audio/{{ audio_file }}.mp3"></audio>
			</a>
			<div class="inside">
				<h5>{{ song_title}}</h5>
				<strong class="capo blink">{{ song_capo }}</strong>
				<br><br>
				{{ song|raw }}
			</div>
		</div>

		<form class="answer" method="post" action="{{ global.request.getRequestUri }}" id="form-answer">
			<h3>{% trans %}Could you sing it?{% endtrans %}</h3>

			<nav>
			{% block answer_buttons %}{% endblock %}
			</nav>
		</form>
	</div>

	{% block messages %}{% endblock %}

	{% import 'base.twig' as self %}
	{{ self.loadJsFramework() }}

	<script>

	var NTSound = {

		initializeSoundControl: function()
		{
			var oAudio = document.getElementsByTagName("audio")[0],
				oPlayControl = document.getElementById("play-control");

			document.getElementById("sound").addEventListener('click', function(event) {
				
				$(oPlayControl).toggleClass("playing").toggleClass("stopped");

				if (oAudio.paused)
				{
					oAudio.play();
				}
				else
				{
					oAudio.pause();
					oAudio.currentTime = 0;
				}
			});
			
			oAudio.addEventListener('ended', function(event)
			{
				$(oPlayControl).removeClass("playing").addClass("stopped");
			});

			oAudio.addEventListener('error', function(event)
			{
				$(document.getElementById("sound")).remove();
			});

			//Auto-play (it is disabled in most of mobile browsers)
			oAudio.play();

			if (!oAudio.paused)
			{
				$(oPlayControl).removeClass("stopped").addClass("playing");
			}
		}
	};

	$(function() {
		NTSound.initializeSoundControl();
	});

	</script>

	{% block js %}{% endblock %}

{% endblock %}
